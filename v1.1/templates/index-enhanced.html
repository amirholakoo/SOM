{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/main.css' %}">
<link rel="stylesheet" href="{% static 'css/mobile.css' %}">
<link rel="stylesheet" href="{% static 'css/selection-styles.css' %}">
{% endblock %}

{% block content %}

<div class="container">
    <nav class="navbar">
        <div class="navbar-header">
            <span class="navbar-logo">ฺฉุงุฑุฎุงูู ฺฉุงุบุฐ ู ูููุง ููุงูู</span>
            <button class="navbar-toggle" onclick="toggleMenu()">โฐ</button>
        </div>
        <ul class="nav-list" id="navbarMenu">
            <li class="nav-item"><a href="index.html" class="nav-link">ุฎุงูู</a></li>
            <li class="nav-item"><a href="#cashSection" class="nav-link">ููุช ููุฏ</a></li>
            <li class="nav-item"><a href="#creditSection" class="nav-link">ููุช ูุณู</a></li>
            <li class="nav-item"><a href="#contactSection" class="nav-link">ุชูุงุณ ุจุง ูุง</a></li>
            <li class="nav-item"><a href="../Auth/login.html" class="nav-link">ูุฑูุฏ</a></li>
        </ul>
    </nav>

    <!-- Main Content - Shown during working hours -->
    <main class="main-content" id="mainContent">
        <section id="cashSection" class="section cash-section">
            <div class="section-header">
                <h2 class="section-title">ูู333</h2>
            </div>

            <div class="info-grid">
                <div class="info-card">
                    <div class="info-label">ููุช ููุฏ</div>
                    <div class="info-value" id="cashPrice">ฒ,ตฐฐ,ฐฐฐ ุชููุงู</div>
                </div>
            </div>

            <!-- ุฌุฏูู ููุฌูุฏ ููุฏ -->
            <div class="stock-table-container">
                <h3 class="stock-title">ููุฌูุฏ ููุฏ - ุงูุชุฎุงุจ ูุญุตูู</h3>
                <div class="selected-count">
                    ุชุนุฏุงุฏ ุงูุชุฎุงุจ ุดุฏู: <span id="cashSelectedCount">0</span> ุงุฒ 6
                </div>
                <div class="table-responsive">
                    <table class="stock-table" id="cashStockTable">
                        <thead>
                            <tr>
                                <th>ุงูุชุฎุงุจ</th>
                                <th>ุนุฑุถ ฺฉุงุบุฐ (ุณุงูุชโูุชุฑ)</th>
                                <th>ฺฏุฑูุงฺ (ฺฏุฑู)</th>
                                <th>ุชุนุฏุงุฏ ููุฌูุฏ</th>
                                <th>ููุช ูุงุญุฏ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="stock-row" data-type="cash">
                                <td><input type="checkbox" class="stock-checkbox" data-section="cash"></td>
                                <td>70</td>
                                <td>80</td>
                                <td>50 ฺฉูู</td>
                                <td>2,400,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="cash">
                                <td><input type="checkbox" class="stock-checkbox" data-section="cash"></td>
                                <td>100</td>
                                <td>90</td>
                                <td>30 ฺฉูู</td>
                                <td>2,500,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="cash">
                                <td><input type="checkbox" class="stock-checkbox" data-section="cash"></td>
                                <td>120</td>
                                <td>100</td>
                                <td>40 ฺฉูู</td>
                                <td>2,600,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="cash">
                                <td><input type="checkbox" class="stock-checkbox" data-section="cash"></td>
                                <td>150</td>
                                <td>120</td>
                                <td>25 ฺฉูู</td>
                                <td>2,700,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="cash">
                                <td><input type="checkbox" class="stock-checkbox" data-section="cash"></td>
                                <td>80</td>
                                <td>110</td>
                                <td>35 ฺฉูู</td>
                                <td>2,550,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="cash">
                                <td><input type="checkbox" class="stock-checkbox" data-section="cash"></td>
                                <td>90</td>
                                <td>85</td>
                                <td>45 ฺฉูู</td>
                                <td>2,450,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="cash">
                                <td><input type="checkbox" class="stock-checkbox" data-section="cash"></td>
                                <td>110</td>
                                <td>95</td>
                                <td>28 ฺฉูู</td>
                                <td>2,580,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="cash">
                                <td><input type="checkbox" class="stock-checkbox" data-section="cash"></td>
                                <td>130</td>
                                <td>105</td>
                                <td>32 ฺฉูู</td>
                                <td>2,650,000 ุชููุงู</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="button-container">
                <button class="purchase-btn cash-btn" onclick="handleCashPurchase()" id="cashPurchaseBtn" disabled>
                    <span class="btn-icon">๐ฐ</span>
                    <span class="btn-text">ุฎุฑุฏ ููุฏ</span>
                </button>
            </div>
        </section>

        <section id="creditSection" class="section credit-section">
            <div class="section-header">
                <h2 class="section-title">ูุณู</h2>
            </div>

            <div class="info-grid">
                <div class="info-card">
                    <div class="info-label">ููุช ูุณู</div>
                    <div class="info-value" id="creditPrice">ฒ,ธฐฐ,ฐฐฐ ุชููุงู</div>
                </div>
            </div>

            <!-- ุฌุฏูู ููุฌูุฏ ูุณู -->
            <div class="stock-table-container">
                <h3 class="stock-title">ููุฌูุฏ ูุณู - ุงูุชุฎุงุจ ูุญุตูู</h3>
                <div class="selected-count">
                    ุชุนุฏุงุฏ ุงูุชุฎุงุจ ุดุฏู: <span id="creditSelectedCount">0</span> ุงุฒ 6
                </div>
                <div class="table-responsive">
                    <table class="stock-table" id="creditStockTable">
                        <thead>
                            <tr>
                                <th>ุงูุชุฎุงุจ</th>
                                <th>ุนุฑุถ ฺฉุงุบุฐ (ุณุงูุชโูุชุฑ)</th>
                                <th>ฺฏุฑูุงฺ (ฺฏุฑู)</th>
                                <th>ุชุนุฏุงุฏ ููุฌูุฏ</th>
                                <th>ููุช ูุงุญุฏ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="stock-row" data-type="credit">
                                <td><input type="checkbox" class="stock-checkbox" data-section="credit"></td>
                                <td>70</td>
                                <td>80</td>
                                <td>60 ฺฉูู</td>
                                <td>2,700,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="credit">
                                <td><input type="checkbox" class="stock-checkbox" data-section="credit"></td>
                                <td>100</td>
                                <td>90</td>
                                <td>40 ฺฉูู</td>
                                <td>2,800,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="credit">
                                <td><input type="checkbox" class="stock-checkbox" data-section="credit"></td>
                                <td>120</td>
                                <td>100</td>
                                <td>50 ฺฉูู</td>
                                <td>2,900,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="credit">
                                <td><input type="checkbox" class="stock-checkbox" data-section="credit"></td>
                                <td>150</td>
                                <td>120</td>
                                <td>35 ฺฉูู</td>
                                <td>3,000,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="credit">
                                <td><input type="checkbox" class="stock-checkbox" data-section="credit"></td>
                                <td>80</td>
                                <td>110</td>
                                <td>45 ฺฉูู</td>
                                <td>2,850,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="credit">
                                <td><input type="checkbox" class="stock-checkbox" data-section="credit"></td>
                                <td>90</td>
                                <td>85</td>
                                <td>55 ฺฉูู</td>
                                <td>2,750,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="credit">
                                <td><input type="checkbox" class="stock-checkbox" data-section="credit"></td>
                                <td>110</td>
                                <td>95</td>
                                <td>38 ฺฉูู</td>
                                <td>2,880,000 ุชููุงู</td>
                            </tr>
                            <tr class="stock-row" data-type="credit">
                                <td><input type="checkbox" class="stock-checkbox" data-section="credit"></td>
                                <td>130</td>
                                <td>105</td>
                                <td>42 ฺฉูู</td>
                                <td>2,950,000 ุชููุงู</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="button-container">
                <button class="purchase-btn credit-btn" onclick="handleCreditPurchase()" id="creditPurchaseBtn"
                    disabled>
                    <span class="btn-icon">๐</span>
                    <span class="btn-text">ุฎุฑุฏ ูุณู</span>
                </button>
            </div>
        </section>
    </main>

    <!-- Footer section remains the same -->
    <footer id="contactSection" class="footer">
        <div class="footer-content">
            <div class="footer-section contact-info">
                <h3 class="footer-title">ุงุทูุงุนุงุช ุชูุงุณ</h3>
                <div class="contact-items">
                    <div class="contact-item">
                        <span class="contact-icon">๐</span>
                        <div class="contact-details">
                            <span class="contact-label">ุชููู ุชูุงุณ:</span>
                            <span class="contact-value">ฐฒฑ-ฑฒณดตถทธ</span>
                        </div>
                    </div>
                    <div class="contact-item">
                        <span class="contact-icon">๐ฑ</span>
                        <div class="contact-details">
                            <span class="contact-label">ููุจุงู:</span>
                            <span class="contact-value">ฐนฑฒ-ณดต-ถทธน</span>
                        </div>
                    </div>
                    <div class="contact-item email-item">
                        <span class="contact-icon">๐ง</span>
                        <div class="contact-details">
                            <span class="contact-label">ุงูู:</span>
                            <span class="contact-value">info@homayounpaper.com</span>
                        </div>
                    </div>
                    <div class="contact-item">
                        <span class="contact-icon">๐</span>
                        <div class="contact-details">
                            <span class="contact-label">ุขุฏุฑุณ:</span>
                            <span class="contact-value">ุชูุฑุงูุ ุฎุงุจุงู ููุนุตุฑุ ูพูุงฺฉ ฑฒณ</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer-section working-hours">
                <h3 class="footer-title">ุณุงุนุงุช ฺฉุงุฑ</h3>
                <div class="hours-info">
                    <div class="hours-item">
                        <span class="hours-label">ุดูุจู ุชุง ฺูุงุฑุดูุจู:</span>
                        <span class="hours-value">ฐธ:ฐฐ - ฑธ:ฐฐ</span>
                    </div>
                    <div class="hours-item">
                        <span class="hours-label">ูพูุฌโุดูุจู:</span>
                        <span class="hours-value">ฐธ:ฐฐ - ฑถ:ฐฐ</span>
                    </div>
                    <div class="hours-item">
                        <span class="hours-label">ุฌูุนู:</span>
                        <span class="hours-value">ุชุนุทู</span>
                    </div>
                </div>
            </div>

            <div class="footer-section about-us">
                <h3 class="footer-title">ุฏุฑุจุงุฑู ูุง</h3>
                <p class="about-text">
                    ฺฉุงุฑุฎุงูู ฺฉุงุบุฐ ู ูููุง ููุงูู ุจุง ุจุด ุงุฒ ฒฐ ุณุงู ุชุฌุฑุจู ุฏุฑ ุชููุฏ ู ูุฑูุด
                    ุงููุงุน ฺฉุงุบุฐ ู ูููุงุ ุงุฑุงุฆูโุฏููุฏู ุจูุชุฑู ูุญุตููุงุช ุจุง ฺฉูุช ู ููุช ููุงุณุจ ูโุจุงุดุฏ.
                </p>
                <div class="social-links">
                    <a href="#" class="social-link">๐</a>
                    <a href="#" class="social-link">๐ท</a>
                    <a href="#" class="social-link">๐</a>
                </div>
            </div>
        </div>
    </footer>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/index.js' %}"></script>
<script>
    // Toggle mobile menu
    function toggleMenu() {
        const navList = document.getElementById('navbarMenu');
        navList.classList.toggle('show');
    }

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Enhanced Stock table selection functionality
    let selectedItems = {
        cash: 0,
        credit: 0
    };

    function updateSelectionCount(section) {
        const countElement = document.getElementById(section + 'SelectedCount');
        const purchaseBtn = document.getElementById(section + 'PurchaseBtn');

        countElement.textContent = selectedItems[section];

        // Enable/disable purchase button based on selection
        if (selectedItems[section] > 0) {
            purchaseBtn.disabled = false;
            purchaseBtn.classList.remove('disabled');
        } else {
            purchaseBtn.disabled = true;
            purchaseBtn.classList.add('disabled');
        }
    }

    function handleSelectionButtonClick(button) {
        const section = button.dataset.section;
        const row = button.closest('.stock-row');
        const checkbox = row.querySelector('.stock-checkbox');

        if (button.classList.contains('selected')) {
            // Deselect
            button.classList.remove('selected');
            button.querySelector('.selection-icon').textContent = 'โญ';
            button.querySelector('span:last-child').textContent = 'ุงูุชุฎุงุจ';
            checkbox.checked = false;
            selectedItems[section]--;
            row.classList.remove('selected');
        } else {
            // Check if already 6 items selected
            if (selectedItems[section] >= 6) {
                alert('ุญุฏุงฺฉุซุฑ 6 ููุฑุฏ ูุงุจู ุงูุชุฎุงุจ ุงุณุช!');
                return;
            }
            // Select
            button.classList.add('selected');
            button.querySelector('.selection-icon').textContent = 'โ';
            button.querySelector('span:last-child').textContent = 'ุงูุชุฎุงุจ ุดุฏู';
            checkbox.checked = true;
            selectedItems[section]++;
            row.classList.add('selected');
        }

        updateSelectionCount(section);
    }

    function handleCheckboxChange(checkbox) {
        const section = checkbox.dataset.section;
        const row = checkbox.closest('.stock-row');
        const button = row.querySelector('.selection-btn');

        if (checkbox.checked) {
            // Check if already 6 items selected
            if (selectedItems[section] >= 6) {
                checkbox.checked = false;
                alert('ุญุฏุงฺฉุซุฑ 6 ููุฑุฏ ูุงุจู ุงูุชุฎุงุจ ุงุณุช!');
                return;
            }
            selectedItems[section]++;
            row.classList.add('selected');
            if (button) {
                button.classList.add('selected');
                button.querySelector('.selection-icon').textContent = 'โ';
                button.querySelector('span:last-child').textContent = 'ุงูุชุฎุงุจ ุดุฏู';
            }
        } else {
            selectedItems[section]--;
            row.classList.remove('selected');
            if (button) {
                button.classList.remove('selected');
                button.querySelector('.selection-icon').textContent = 'โญ';
                button.querySelector('span:last-child').textContent = 'ุงูุชุฎุงุจ';
            }
        }

        updateSelectionCount(section);
    }

    // Initialize selection buttons
    function initializeSelectionButtons() {
        // Replace all checkbox cells with custom selection buttons
        const checkboxCells = document.querySelectorAll('td input.stock-checkbox');

        checkboxCells.forEach(checkbox => {
            const section = checkbox.dataset.section;
            const cell = checkbox.closest('td');

            // Create selection button structure
            cell.innerHTML = `
                <div class="selection-container">
                    <button class="selection-btn" data-section="${section}">
                        <span class="selection-icon">โญ</span>
                        <span>ุงูุชุฎุงุจ</span>
                    </button>
                    <input type="checkbox" class="stock-checkbox" data-section="${section}" style="display: none;">
                </div>
            `;
        });

        // Add event listeners to all selection buttons
        const selectionButtons = document.querySelectorAll('.selection-btn');
        selectionButtons.forEach(button => {
            button.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation();
                handleSelectionButtonClick(this);
            });
        });

        // Keep checkbox event listeners for compatibility
        const checkboxes = document.querySelectorAll('.stock-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function () {
                handleCheckboxChange(this);
            });
        });
    }

    // Add enhanced functionality
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize the beautiful selection buttons
        initializeSelectionButtons();

        // Initialize button states
        updateSelectionCount('cash');
        updateSelectionCount('credit');

        // Add row click functionality (optional - click on row to select)
        const stockRows = document.querySelectorAll('.stock-row');
        stockRows.forEach(row => {
            row.addEventListener('click', function (e) {
                // Only trigger if not clicking on the selection button directly
                if (!e.target.closest('.selection-btn')) {
                    const button = this.querySelector('.selection-btn');
                    if (button) {
                        handleSelectionButtonClick(button);
                    }
                }
            });
        });
    });

    function handleCashPurchase() {
        const selectedRows = document.querySelectorAll('#cashStockTable .stock-row.selected');
        if (selectedRows.length === 0) {
            alert('ูุทูุง ุญุฏุงูู ฺฉ ููุฑุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ');
            return;
        }

        let purchaseList = [];
        selectedRows.forEach(row => {
            const cells = row.querySelectorAll('td');
            purchaseList.push({
                width: cells[1].textContent,
                grammage: cells[2].textContent,
                quantity: cells[3].textContent,
                price: cells[4].textContent
            });
        });

        console.log('ุฎุฑุฏ ููุฏ:', purchaseList);
        alert(`${selectedRows.length} ููุฑุฏ ุจุฑุง ุฎุฑุฏ ููุฏ ุงูุชุฎุงุจ ุดุฏ`);
    }

    function handleCreditPurchase() {
        const selectedRows = document.querySelectorAll('#creditStockTable .stock-row.selected');
        if (selectedRows.length === 0) {
            alert('ูุทูุง ุญุฏุงูู ฺฉ ููุฑุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ');
            return;
        }

        let purchaseList = [];
        selectedRows.forEach(row => {
            const cells = row.querySelectorAll('td');
            purchaseList.push({
                width: cells[1].textContent,
                grammage: cells[2].textContent,
                quantity: cells[3].textContent,
                price: cells[4].textContent
            });
        });

        console.log('ุฎุฑุฏ ูุณู:', purchaseList);
        alert(`${selectedRows.length} ููุฑุฏ ุจุฑุง ุฎุฑุฏ ูุณู ุงูุชุฎุงุจ ุดุฏ`);
    }
</script>
{% endblock %}