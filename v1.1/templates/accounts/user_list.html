{% extends 'base.html' %}
{% load static %}

{% block title %}Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† - HomayOMS{% endblock %}

{% block extra_css %}
<style>
    .user-list-header {
        background: linear-gradient(90deg, #3498db 0%, #6dd5fa 100%);
        color: #fff;
        border-radius: 1rem;
        padding: 2rem 1rem 1rem 1rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 24px rgba(52, 152, 219, 0.08);
    }

    .user-list-card {
        border-radius: 1rem;
        box-shadow: 0 2px 12px rgba(52, 152, 219, 0.07);
        margin-bottom: 1.5rem;
    }

    .status-badge {
        font-size: 0.75rem;
        padding: 0.375rem 0.75rem;
    }

    .status-pending {
        background-color: #ffc107;
        color: #000;
    }

    .status-active {
        background-color: #198754;
        color: #fff;
    }

    .status-inactive {
        background-color: #dc3545;
        color: #fff;
    }

    .status-suspended {
        background-color: #6c757d;
        color: #fff;
    }

    .action-buttons {
        display: flex;
        gap: 0.25rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn-verify {
        background-color: #198754;
        border-color: #198754;
        color: white;
    }

    .btn-verify:hover {
        background-color: #157347;
        border-color: #157347;
        color: white;
    }

    .btn-reject {
        background-color: #dc3545;
        border-color: #dc3545;
        color: white;
    }

    .btn-reject:hover {
        background-color: #bb2d3b;
        border-color: #bb2d3b;
        color: white;
    }

    .pending-notice {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        color: #856404;
    }

    .role-badge {
        font-size: 0.75rem;
        padding: 0.375rem 0.75rem;
    }

    .role-customer {
        background-color: #0d6efd;
        color: white;
    }

    .role-admin {
        background-color: #fd7e14;
        color: white;
    }

    .role-super-admin {
        background-color: #dc3545;
        color: white;
    }

    .role-finance {
        background-color: #198754;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="user-list-header d-flex align-items-center justify-content-between flex-wrap mb-4">
        <div>
            <h2 class="mb-1">Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>
            <div class="small">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø³ÛŒØ³ØªÙ…</div>
        </div>
        <div class="d-flex align-items-center gap-3 mt-3 mt-md-0">
            <a href="{% url 'accounts:dashboard' %}" class="btn btn-outline-light btn-sm">ğŸ  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
            {% if request.user.is_super_admin %}
            <a href="{% url 'accounts:customer_registration' %}" class="btn btn-success btn-sm">â• Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</a>
            {% endif %}
        </div>
    </div>

    <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… -->
    {% if messages %}
    <div class="mb-4">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± -->
    {% if pending_customers_count > 0 %}
    <div class="pending-notice">
        <strong>â³ {{ pending_customers_count }} Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯</strong><br>
        Ù„Ø·ÙØ§Ù‹ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ØªØ§ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯.
    </div>
    {% endif %}

    <div class="card user-list-card">
        <div class="card-body">
            <table class="table table-striped table-hover align-middle text-center">
                <thead>
                    <tr>
                        <th>Ù†Ø§Ù…</th>
                        <th>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th>
                        <th>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th>
                        <th>Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</th>
                        <th>Ù†Ù‚Ø´</th>
                        <th>ÙˆØ¶Ø¹ÛŒØª</th>
                        <th>ØªØ§Ø±ÛŒØ® Ø¹Ø¶ÙˆÛŒØª</th>
                        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.first_name|default:"-" }}</td>
                        <td>{{ user.last_name|default:"-" }}</td>
                        <td>
                            <strong>{{ user.username }}</strong>
                            {% if user.role == 'customer' and user.status == 'pending' %}
                            <br><small class="text-warning">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯</small>
                            {% endif %}
                        </td>
                        <td dir="ltr">{{ user.phone|default:"-" }}</td>
                        <td>
                            {% if user.role == 'customer' %}
                            <span class="badge role-badge role-customer">ğŸ”µ Ù…Ø´ØªØ±ÛŒ</span>
                            {% elif user.role == 'admin' %}
                            <span class="badge role-badge role-admin">ğŸŸ¡ Ø§Ø¯Ù…ÛŒÙ†</span>
                            {% elif user.role == 'super_admin' %}
                            <span class="badge role-badge role-super-admin">ğŸ”´ Ø³ÙˆÙ¾Ø± Ø§Ø¯Ù…ÛŒÙ†</span>
                            {% elif user.role == 'finance' %}
                            <span class="badge role-badge role-finance">ğŸŸ¢ Ù…Ø§Ù„ÛŒ</span>
                            {% else %}
                            <span class="badge bg-secondary">{{ user.get_role_display }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if user.status == 'pending' %}
                            <span class="badge status-badge status-pending">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
                            {% elif user.status == 'active' %}
                            <span class="badge status-badge status-active">âœ… ÙØ¹Ø§Ù„</span>
                            {% elif user.status == 'inactive' %}
                            <span class="badge status-badge status-inactive">âŒ ØºÛŒØ±ÙØ¹Ø§Ù„</span>
                            {% elif user.status == 'suspended' %}
                            <span class="badge status-badge status-suspended">â¸ï¸ Ù…Ø¹Ù„Ù‚</span>
                            {% else %}
                            <span class="badge bg-secondary">{{ user.get_status_display }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <small>{{ user.date_joined|date:"Y/m/d" }}</small>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <a href="{% url 'accounts:user_detail' user.id %}"
                                    class="btn btn-sm btn-outline-primary">
                                    ğŸ‘ï¸ Ø¬Ø²Ø¦ÛŒØ§Øª
                                </a>

                                <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ùˆ Ø­Ø°Ù Ø¨Ø±Ø§ÛŒ Super Admin -->
                                {% if request.user.is_super_admin %}
                                <a href="{% url 'accounts:edit_user' user.id %}" class="btn btn-sm btn-outline-warning">
                                    âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´
                                </a>

                                <!-- Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø­Ø°Ù Ø®ÙˆØ¯ Super Admin -->
                                {% if user != request.user %}
                                <form method="post" action="{% url 'accounts:delete_user' user.id %}"
                                    style="display: inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-outline-danger"
                                        onclick="return confirm('âš ï¸ Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø± {{ user.username }} Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ\n\nØ§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª Ùˆ ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø­Ø°Ù Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.')">
                                        ğŸ—‘ï¸ Ø­Ø°Ù
                                    </button>
                                </form>
                                {% endif %}
                                {% endif %}

                                {% if user.role == 'customer' and user.status == 'pending' %}
                                <form method="post" action="{% url 'accounts:verify_customer' user.id %}"
                                    style="display: inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-verify"
                                        onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² ØªØ§ÛŒÛŒØ¯ Ø§ÛŒÙ† Ù…Ø´ØªØ±ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')">
                                        âœ… ØªØ§ÛŒÛŒØ¯
                                    </button>
                                </form>

                                <form method="post" action="{% url 'accounts:reject_customer' user.id %}"
                                    style="display: inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-reject"
                                        onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø±Ø¯ Ø§ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.')">
                                        âŒ Ø±Ø¯
                                    </button>
                                </form>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="9" class="text-center py-4">
                            <div class="text-muted">
                                <i class="fas fa-users fa-2x mb-2"></i><br>
                                Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    function showRoleManagement() {
        alert('ğŸš§ Ù‚Ø§Ø¨Ù„ÛŒØª Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª.\n\nÙØ¹Ù„Ø§Ù‹ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø·Ø±ÛŒÙ‚ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ØŒ Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯.');
    }
</script>
{% endblock %}