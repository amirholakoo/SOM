{% extends 'base.html' %}
{% load static %}
{% block title %}{{ title }}{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/main.css' %}">
<link rel="stylesheet" href="{% static 'css/mobile.css' %}">
<link rel="stylesheet" href="{% static 'css/selection-styles.css' %}">
{% endblock %}
{% block content %}

<div class="container">
    <nav class="navbar">
        <div class="navbar-header">
            <span class="navbar-logo">Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ú©Ø§ØºØ° Ùˆ Ù…Ù‚ÙˆØ§ÛŒ Ù‡Ù…Ø§ÛŒÙˆÙ†</span>
            <button class="navbar-toggle" onclick="toggleMenu()">â˜°</button>
        </div>
        <ul class="nav-list" id="navbarMenu">
            <li class="nav-item"><a href="/" class="nav-link">Ø®Ø§Ù†Ù‡</a></li>
            <li class="nav-item"><a href="#cashSection" class="nav-link">Ù‚ÛŒÙ…Øª Ù†Ù‚Ø¯ÛŒ</a></li>
            <li class="nav-item"><a href="#creditSection" class="nav-link">Ù‚ÛŒÙ…Øª Ù†Ø³ÛŒÙ‡</a></li>
            <li class="nav-item"><a href="#contactSection" class="nav-link">ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</a></li>
            {% if user.is_authenticated %}
            <li class="nav-item"><a href="{% url 'accounts:logout' %}" class="nav-link">Ø®Ø±ÙˆØ¬</a></li>
            {% else %}
            <li class="nav-item"><a href="{% url 'accounts:login' %}" class="nav-link">ÙˆØ±ÙˆØ¯</a></li>
            {% endif %}
        </ul>
    </nav>

    <!-- Main Content - Shown during working hours -->
    <main class="main-content" id="mainContent">
        <section id="cashSection" class="section cash-section">
            <div class="section-header">
                <h2 class="section-title">Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…ÙˆØ¬ÙˆØ¯</h2>
            </div>

            <div class="info-grid">
                <div class="info-card">
                    <div class="info-label">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª</div>
                    <div class="info-value" id="cashPrice">
                        {% if products %}
                        {{ products|length }} Ù…Ø­ØµÙˆÙ„
                        {% else %}
                        <span class="no-price">Ù…Ø­ØµÙˆÙ„ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù†Ù‚Ø¯ÛŒ -->
            <div class="stock-table-container">
                <h3 class="stock-title">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù†Ù‚Ø¯ÛŒ - Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„</h3>
                <div class="selected-count">
                    ØªØ¹Ø¯Ø§Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡: <span id="cashSelectedCount">0</span> Ø§Ø² <span id="cashTotalCount">0</span>
                </div>
                <div class="table-responsive">
                    <table class="stock-table" id="cashStockTable">
                        <thead>
                            <tr>
                                <th>Ø§Ù†ØªØ®Ø§Ø¨</th>
                                <th>Ø´Ù…Ø§Ø±Ù‡ Ø±ÛŒÙ„</th>
                                <th>Ø¹Ø±Ø¶ (mm)</th>
                                <th>Ú¯Ø±Ù…Ø§Ú˜ (g/mÂ²)</th>
                                <th>Ø·ÙˆÙ„ (m)</th>
                                <th>Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ù…Ú©Ø§Ù† Ø§Ù†Ø¨Ø§Ø±</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if products %}
                            {% for product in products %}
                            <tr class="stock-row" data-type="cash" data-product-id="{{ product.id }}">
                                <td><input type="checkbox" class="stock-checkbox" data-section="cash"></td>
                                <td>{{ product.reel_number }}</td>
                                <td>{{ product.width }}</td>
                                <td>{{ product.gsm }}</td>
                                <td>{{ product.length }}</td>
                                <td>{{ product.price|floatformat:0 }}</td>
                                <td>
                                    {% if product.status == 'In-stock' %}
                                    <span class="status-badge available">ğŸ“¦ Ù…ÙˆØ¬ÙˆØ¯</span>
                                    {% elif product.status == 'Sold' %}
                                    <span class="status-badge sold">ğŸ’° ÙØ±ÙˆØ®ØªÙ‡ Ø´Ø¯Ù‡</span>
                                    {% elif product.status == 'Pre-order' %}
                                    <span class="status-badge preorder">â³ Ù¾ÛŒØ´â€ŒØ³ÙØ§Ø±Ø´</span>
                                    {% endif %}
                                </td>
                                <td>{{ product.get_location_display }}</td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="8" class="text-center">
                                    <div class="no-products-message">
                                        <p>ğŸ” Ù…Ø­ØµÙˆÙ„ÛŒ Ø¯Ø± Ø§Ù†Ø¨Ø§Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
                                        <small>Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯Ø§Ù‹ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ø§ Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ… ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯</small>
                                    </div>
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="button-container">
                <button class="purchase-btn cash-btn" onclick="handleCashPurchase()" id="cashPurchaseBtn" disabled>
                    <span class="btn-icon">ğŸ’°</span>
                    <span class="btn-text">Ø®Ø±ÛŒØ¯ Ù†Ù‚Ø¯ÛŒ</span>
                </button>
            </div>
        </section>

        <section id="creditSection" class="section credit-section">
            <div class="section-header">
                <h2 class="section-title">Ù†Ø³ÛŒÙ‡</h2>
            </div>

            <div class="info-grid">
                <div class="info-card">
                    <div class="info-label">Ù‚ÛŒÙ…Øª Ù†Ø³ÛŒÙ‡</div>
                    <div class="info-value" id="creditPrice">
                        {% if credit_products %}
                        {% with first_product=credit_products.0 %}
                        {{ first_product.price|floatformat:0 }} ØªÙˆÙ…Ø§Ù†
                        {% endwith %}
                        {% elif price_data.credit.price %}
                        {{ price_data.credit.price|floatformat:0 }} ØªÙˆÙ…Ø§Ù†
                        {% else %}
                        <span class="no-price">Ù‚ÛŒÙ…Øª Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù†Ø³ÛŒÙ‡ -->
            <div class="stock-table-container">
                <h3 class="stock-title">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù†Ø³ÛŒÙ‡ - Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„</h3>
                <div class="selected-count">
                    ØªØ¹Ø¯Ø§Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡: <span id="creditSelectedCount">0</span> Ø§Ø² <span id="creditTotalCount">0</span>
                </div>
                <div class="table-responsive">
                    <table class="stock-table" id="creditStockTable">
                        <thead>
                            <tr>
                                <th>Ø§Ù†ØªØ®Ø§Ø¨</th>
                                <th>Ø´Ù…Ø§Ø±Ù‡ Ø±ÛŒÙ„</th>
                                <th>Ø¹Ø±Ø¶ (mm)</th>
                                <th>Ú¯Ø±Ù…Ø§Ú˜ (g/mÂ²)</th>
                                <th>Ø·ÙˆÙ„ (m)</th>
                                <th>Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ù…Ú©Ø§Ù† Ø§Ù†Ø¨Ø§Ø±</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if products %}
                            {% for product in products %}
                            <tr class="stock-row" data-type="credit" data-product-id="{{ product.id }}">
                                <td><input type="checkbox" class="stock-checkbox" data-section="credit"></td>
                                <td>{{ product.reel_number }}</td>
                                <td>{{ product.width }}</td>
                                <td>{{ product.gsm }}</td>
                                <td>{{ product.length }}</td>
                                <td>{{ product.price|floatformat:0 }}</td>
                                <td>
                                    {% if product.status == 'In-stock' %}
                                    <span class="status-badge available">ğŸ“¦ Ù…ÙˆØ¬ÙˆØ¯</span>
                                    {% elif product.status == 'Sold' %}
                                    <span class="status-badge sold">ğŸ’° ÙØ±ÙˆØ®ØªÙ‡ Ø´Ø¯Ù‡</span>
                                    {% elif product.status == 'Pre-order' %}
                                    <span class="status-badge preorder">â³ Ù¾ÛŒØ´â€ŒØ³ÙØ§Ø±Ø´</span>
                                    {% endif %}
                                </td>
                                <td>{{ product.get_location_display }}</td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="8" class="text-center">
                                    <div class="no-products-message">
                                        <p>ğŸ” Ù…Ø­ØµÙˆÙ„ÛŒ Ø¯Ø± Ø§Ù†Ø¨Ø§Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
                                        <small>Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯Ø§Ù‹ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ø§ Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ… ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯</small>
                                    </div>
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="button-container">
                <button class="purchase-btn credit-btn" onclick="handleCreditPurchase()" id="creditPurchaseBtn"
                    disabled>
                    <span class="btn-icon">ğŸ“‹</span>
                    <span class="btn-text">Ø®Ø±ÛŒØ¯ Ù†Ø³ÛŒÙ‡</span>
                </button>
            </div>
        </section>
    </main>

    <!-- Closed Content - Shown outside working hours -->
    <main class="closed-content" id="closedContent" style="display: none;">
        <div class="closed-container">
            <div class="closed-icon">ğŸ”’</div>
            <h2 class="closed-title">Ø³Ø§ÛŒØª Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¨Ø³ØªÙ‡ Ø§Ø³Øª</h2>

            <p class="closed-message">
                Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø®Ø§Ø±Ø¬ Ø§Ø² Ø³Ø§Ø¹Øª Ú©Ø§Ø±ÛŒ Ù‡Ø³ØªÛŒÙ….
                Ù„Ø·ÙØ§Ù‹ Ø¯Ø± Ø³Ø§Ø¹Øª Ú©Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ù…Ø±Ø§Ø¬Ø¹Ù‡ ÙØ±Ù…Ø§ÛŒÛŒØ¯.
            </p>

            <div class="working-hours-info">
                <h3 class="working-hours-title">Ø³Ø§Ø¹Øª Ú©Ø§Ø±ÛŒ:</h3>
                <div class="working-hours-time" id="workingHoursDisplay">
                    Ø§Ø² 08:00 ØªØ§ 18:00
                </div>
            </div>

            <div class="contact-info-closed">
                <h4>Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³:</h4>
                <p>ğŸ“ ØªÙ„ÙÙ†: 021-12345678</p>
                <p>ğŸ“§ Ø§ÛŒÙ…ÛŒÙ„: info@homayounpaper.com</p>
                <p>ğŸ“ Ø¢Ø¯Ø±Ø³: ØªÙ‡Ø±Ø§Ù†ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±</p>
            </div>

            <button class="refresh-btn" onclick="checkWorkingHours()">
                <span class="btn-text">Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬Ø¯Ø¯</span>
            </button>
        </div>
    </main>

    <!-- Footer - Always visible -->
    <footer id="contactSection" class="footer">
        <div class="footer-content">
            <div class="footer-section contact-info">
                <h3 class="footer-title">Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³</h3>
                <div class="contact-items">
                    <div class="contact-item">
                        <span class="contact-icon">ğŸ“</span>
                        <div class="contact-details">
                            <span class="contact-label">ØªÙ„ÙÙ† ØªÙ…Ø§Ø³:</span>
                            <span class="contact-value">Û°Û²Û±-Û±Û²Û³Û´ÛµÛ¶Û·Û¸</span>
                        </div>
                    </div>
                    <div class="contact-item">
                        <span class="contact-icon">ğŸ“±</span>
                        <div class="contact-details">
                            <span class="contact-label">Ù…ÙˆØ¨Ø§ÛŒÙ„:</span>
                            <span class="contact-value">Û°Û¹Û±Û²-Û³Û´Ûµ-Û¶Û·Û¸Û¹</span>
                        </div>
                    </div>
                    <div class="contact-item email-item">
                        <span class="contact-icon">ğŸ“§</span>
                        <div class="contact-details">
                            <span class="contact-label">Ø§ÛŒÙ…ÛŒÙ„:</span>
                            <span class="contact-value">info@homayounpaper.com</span>
                        </div>
                    </div>
                    <div class="contact-item">
                        <span class="contact-icon">ğŸ“</span>
                        <div class="contact-details">
                            <span class="contact-label">Ø¢Ø¯Ø±Ø³:</span>
                            <span class="contact-value">ØªÙ‡Ø±Ø§Ù†ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±ØŒ Ù¾Ù„Ø§Ú© Û±Û²Û³</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer-section working-hours">
                <h3 class="footer-title">Ø³Ø§Ø¹Ø§Øª Ú©Ø§Ø±ÛŒ</h3>
                <div class="hours-info">
                    <div class="hours-item">
                        <span class="hours-label">Ø´Ù†Ø¨Ù‡ ØªØ§ Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡:</span>
                        <span class="hours-value">Û°Û¸:Û°Û° - Û±Û¸:Û°Û°</span>
                    </div>
                    <div class="hours-item">
                        <span class="hours-label">Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡:</span>
                        <span class="hours-label">Û°Û¸:Û°Û° - Û±Û¶:Û°Û°</span>
                    </div>
                    <div class="hours-item">
                        <span class="hours-label">Ø¬Ù…Ø¹Ù‡:</span>
                        <span class="hours-value">ØªØ¹Ø·ÛŒÙ„</span>
                    </div>
                </div>
            </div>

            <div class="footer-section about-us">
                <h3 class="footer-title">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</h3>
                <p class="about-text">
                    Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ú©Ø§ØºØ° Ùˆ Ù…Ù‚ÙˆØ§ÛŒ Ù‡Ù…Ø§ÛŒÙˆÙ† Ø¨Ø§ Ø¨ÛŒØ´ Ø§Ø² Û²Û° Ø³Ø§Ù„ ØªØ¬Ø±Ø¨Ù‡ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ùˆ ÙØ±ÙˆØ´
                    Ø§Ù†ÙˆØ§Ø¹ Ú©Ø§ØºØ° Ùˆ Ù…Ù‚ÙˆØ§ØŒ Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ø§ Ú©ÛŒÙÛŒØª Ùˆ Ù‚ÛŒÙ…Øª Ù…Ù†Ø§Ø³Ø¨ Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.
                </p>
                <div class="social-links">
                    <a href="#" class="social-link">ğŸ“˜</a>
                    <a href="#" class="social-link">ğŸ“·</a>
                    <a href="#" class="social-link">ğŸ“</a>
                </div>
            </div>
        </div>
    </footer>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/index.js' %}"></script>
<script>
    // Toggle mobile menu
    function toggleMenu() {
        const navList = document.getElementById('navbarMenu');
        navList.classList.toggle('show');
    }

    // ğŸ”” Custom Popup System
    function createPopup(message, type = 'info', title = '', duration = 3000) {
        // Remove existing popup if any
        const existingPopup = document.querySelector('.popup-overlay');
        if (existingPopup) {
            existingPopup.remove();
        }

        // Set default titles and icons based on type
        const popupConfig = {
            success: {
                title: title || 'Ù…ÙˆÙÙ‚ÛŒØª!',
                icon: 'âœ…'
            },
            error: {
                title: title || 'Ø®Ø·Ø§!',
                icon: 'âŒ'
            },
            warning: {
                title: title || 'Ù‡Ø´Ø¯Ø§Ø±!',
                icon: 'âš ï¸'
            },
            info: {
                title: title || 'Ø§Ø·Ù„Ø§Ø¹!',
                icon: 'â„¹ï¸'
            }
        };

        const config = popupConfig[type] || popupConfig.info;

        // Create popup HTML
        const popupHTML = `
            <div class="popup-overlay" id="customPopup">
                <div class="popup-container ${type}">
                    <button class="popup-close" onclick="closePopup()">Ã—</button>
                    <div class="popup-icon">${config.icon}</div>
                    <div class="popup-title">${config.title}</div>
                    <div class="popup-message">${message}</div>
                    <div class="popup-progress">
                        <div class="popup-progress-bar" id="progressBar"></div>
                    </div>
                </div>
            </div>
        `;

        // Add to body
        document.body.insertAdjacentHTML('beforeend', popupHTML);

        // Show popup with animation
        const popup = document.getElementById('customPopup');
        setTimeout(() => {
            popup.classList.add('show');
        }, 10);

        // Start progress bar animation
        const progressBar = document.getElementById('progressBar');
        setTimeout(() => {
            progressBar.style.width = '0%';
        }, 100);

        // Auto close after duration
        setTimeout(() => {
            closePopup();
        }, duration);

        return popup;
    }

    function closePopup() {
        const popup = document.querySelector('.popup-overlay');
        if (popup) {
            popup.classList.remove('show');
            setTimeout(() => {
                popup.remove();
            }, 300);
        }
    }

    // Replace alert with custom popup
    function showAlert(message, type = 'info', title = '') {
        return createPopup(message, type, title, 3000);
    }

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Stock table selection functionality
    let selectedItems = {
        cash: 0,
        credit: 0
    };

    // Initialize selection buttons
    function initializeSelectionButtons() {
        // Replace all checkbox cells with custom quantity controls
        const checkboxCells = document.querySelectorAll('td input.stock-checkbox');

        checkboxCells.forEach(checkbox => {
            const section = checkbox.dataset.section;
            const cell = checkbox.closest('td');

            // Create quantity control structure
            cell.innerHTML = `
                <div class="quantity-container">
                    <div class="quantity-controls">
                        <button class="qty-btn minus-btn" data-section="${section}" data-action="minus">-</button>
                        <input type="number" class="qty-input" data-section="${section}" min="0" value="0" step="1">
                        <button class="qty-btn plus-btn" data-section="${section}" data-action="plus">+</button>
                    </div>
                </div>
            `;
        });

        // Add event listeners to all quantity buttons and inputs
        const qtyButtons = document.querySelectorAll('.qty-btn');
        qtyButtons.forEach(button => {
            button.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation();
                handleQuantityChange(this);
            });
        });

        const qtyInputs = document.querySelectorAll('.qty-input');
        qtyInputs.forEach(input => {
            input.addEventListener('change', function (e) {
                handleQuantityInputChange(this);
            });

            input.addEventListener('input', function (e) {
                handleQuantityInputChange(this);
            });
        });
    }

    function handleQuantityChange(button) {
        const section = button.dataset.section;
        const action = button.dataset.action;
        const row = button.closest('.stock-row');
        const input = row.querySelector('.qty-input');
        let currentValue = parseInt(input.value) || 0;

        if (action === 'plus') {
            currentValue++;
        } else if (action === 'minus' && currentValue > 0) {
            currentValue--;
        }

        input.value = currentValue;

        // Add animation class
        input.classList.add('updated');
        setTimeout(() => {
            input.classList.remove('updated');
        }, 300);

        updateRowSelection(row, section, currentValue);
    }

    function handleQuantityInputChange(input) {
        const section = input.dataset.section;
        const row = input.closest('.stock-row');
        let value = parseInt(input.value);

        // Validate input
        if (isNaN(value) || value < 0) {
            value = 0;
            input.value = 0;
        }

        // Add animation class for manual input changes
        input.classList.add('updated');
        setTimeout(() => {
            input.classList.remove('updated');
        }, 300);

        updateRowSelection(row, section, value);
    }

    function updateRowSelection(row, section, quantity) {
        if (quantity > 0) {
            row.classList.add('selected');
        } else {
            row.classList.remove('selected');
        }

        // Update total selected count
        updateTotalSelectedCount(section);
    }

    function updateTotalSelectedCount(section) {
        const inputs = document.querySelectorAll(`[data-section="${section}"] .qty-input`);
        let totalSelected = 0;

        inputs.forEach(input => {
            const quantity = parseInt(input.value) || 0;
            if (quantity > 0) {
                totalSelected++;
            }
        });

        selectedItems[section] = totalSelected;
        updateSelectionCount(section);
    }

    function updateSelectionCount(section) {
        const countElement = document.getElementById(section + 'SelectedCount');
        const purchaseBtn = document.getElementById(section + 'PurchaseBtn');

        countElement.textContent = selectedItems[section];

        // Enable/disable purchase button based on selection
        if (selectedItems[section] > 0) {
            purchaseBtn.disabled = false;
            purchaseBtn.classList.remove('disabled');
        } else {
            purchaseBtn.disabled = true;
            purchaseBtn.classList.add('disabled');
        }
    }

    // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø¹Ø§Øª Ú©Ø§Ø±ÛŒ - Ù†Ø³Ø®Ù‡ Ø³Ø§Ø¯Ù‡
    function checkWorkingHours() {
        // ÙØ¹Ù„Ø§Ù‹ Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ø§Ø² Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯
        // Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø§Ø² API Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø¹Ø§Øª Ú©Ø§Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯
        document.getElementById('mainContent').style.display = 'block';
        document.getElementById('closedContent').style.display = 'none';
    }

    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª
    function updateProductCounts() {
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù†Ù‚Ø¯ÛŒ
        const cashRows = document.querySelectorAll('#cashStockTable .stock-row');
        const cashCount = cashRows.length;
        const cashTotalElement = document.getElementById('cashTotalCount');
        if (cashTotalElement) {
            cashTotalElement.textContent = cashCount;
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù†Ø³ÛŒÙ‡
        const creditRows = document.querySelectorAll('#creditStockTable .stock-row');
        const creditCount = creditRows.length;
        const creditTotalElement = document.getElementById('creditTotalCount');
        if (creditTotalElement) {
            creditTotalElement.textContent = creditCount;
        }
    }

    // Add event listeners to all checkboxes
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize the beautiful selection buttons
        initializeSelectionButtons();

        // Initialize button states
        updateSelectionCount('cash');
        updateSelectionCount('credit');

        // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø¹Ø§Øª Ú©Ø§Ø±ÛŒ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
        checkWorkingHours();

        // Add row click functionality (optional - click on row to select)
        const stockRows = document.querySelectorAll('.stock-row');
        stockRows.forEach(row => {
            row.addEventListener('click', function (e) {
                // Only trigger if not clicking on the quantity controls directly
                if (!e.target.closest('.quantity-controls')) {
                    const plusBtn = this.querySelector('.plus-btn');
                    if (plusBtn) {
                        handleQuantityChange(plusBtn);
                    }
                }
            });
        });
    });

    function handleCashPurchase() {
        const selectedRows = document.querySelectorAll('#cashStockTable .stock-row.selected');
        if (selectedRows.length === 0) {
            showAlert('Ù„Ø·ÙØ§ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù…ÙˆØ±Ø¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error', 'Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„');
            return;
        }

        let purchaseList = [];
        let totalItems = 0;

        selectedRows.forEach(row => {
            const cells = row.querySelectorAll('td');
            const qtyInput = row.querySelector('.qty-input');
            const quantity = parseInt(qtyInput.value) || 0;

            if (quantity > 0) {
                totalItems += quantity;
                purchaseList.push({
                    width: cells[1].textContent,
                    grammage: cells[2].textContent,
                    stock: cells[3].textContent,
                    unitPrice: cells[4].textContent,
                    selectedQuantity: quantity
                });
            }
        });

        console.log('Ø®Ø±ÛŒØ¯ Ù†Ù‚Ø¯ÛŒ:', purchaseList);
        showAlert(`${selectedRows.length} Ù†ÙˆØ¹ Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹ ${totalItems} Ø¹Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ù†Ù‚Ø¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯`, 'success', 'Ø®Ø±ÛŒØ¯ Ù…ÙˆÙÙ‚');
    }

    function handleCreditPurchase() {
        const selectedRows = document.querySelectorAll('#creditStockTable .stock-row.selected');
        if (selectedRows.length === 0) {
            showAlert('Ù„Ø·ÙØ§ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù…ÙˆØ±Ø¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error', 'Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„');
            return;
        }

        let purchaseList = [];
        let totalItems = 0;

        selectedRows.forEach(row => {
            const cells = row.querySelectorAll('td');
            const qtyInput = row.querySelector('.qty-input');
            const quantity = parseInt(qtyInput.value) || 0;

            if (quantity > 0) {
                totalItems += quantity;
                purchaseList.push({
                    width: cells[1].textContent,
                    grammage: cells[2].textContent,
                    stock: cells[3].textContent,
                    unitPrice: cells[4].textContent,
                    selectedQuantity: quantity
                });
            }
        });

        console.log('Ø®Ø±ÛŒØ¯ Ù†Ø³ÛŒÙ‡:', purchaseList);
        showAlert(`${selectedRows.length} Ù†ÙˆØ¹ Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹ ${totalItems} Ø¹Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ù†Ø³ÛŒÙ‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯`, 'success', 'Ø®Ø±ÛŒØ¯ Ù…ÙˆÙÙ‚');
    }
</script>
{% endblock %}