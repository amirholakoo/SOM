{% extends 'base.html' %}
{% load static %}

{% block title %}ğŸ“¦ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ - HomayOMS{% endblock %}

{% block extra_css %}
<style>
    .inventory-header {
        background: linear-gradient(135deg, #6f42c1, #e83e8c);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 15px;
    }
    
    .inventory-stats {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }
    
    .stat-box {
        text-align: center;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 1rem;
        position: relative;
        overflow: hidden;
    }
    
    .stat-box::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1));
        pointer-events: none;
    }
    
    .stat-primary { background: linear-gradient(45deg, #6f42c1, #e83e8c); color: white; }
    .stat-success { background: linear-gradient(45deg, #28a745, #20c997); color: white; }
    .stat-warning { background: linear-gradient(45deg, #ffc107, #fd7e14); color: white; }
    .stat-danger { background: linear-gradient(45deg, #dc3545, #c82333); color: white; }
    .stat-info { background: linear-gradient(45deg, #17a2b8, #6f42c1); color: white; }
    
    .warehouse-section {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }
    
    .warehouse-card {
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
        background: linear-gradient(135deg, #f8f9fa, #ffffff);
    }
    
    .warehouse-card:hover {
        border-color: #6f42c1;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(111, 66, 193, 0.15);
    }
    
    .warehouse-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e9ecef;
    }
    
    .warehouse-name {
        font-size: 1.1rem;
        font-weight: bold;
        color: #6f42c1;
    }
    
    .capacity-bar {
        background: #e9ecef;
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
        margin: 0.5rem 0;
    }
    
    .capacity-fill {
        height: 100%;
        transition: width 0.3s ease;
    }
    
    .capacity-low { background: linear-gradient(90deg, #28a745, #20c997); }
    .capacity-medium { background: linear-gradient(90deg, #ffc107, #fd7e14); }
    .capacity-high { background: linear-gradient(90deg, #dc3545, #c82333); }
    
    .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .product-mini-card {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1rem;
        text-align: center;
        transition: all 0.3s ease;
    }
    
    .product-mini-card:hover {
        border-color: #6f42c1;
        box-shadow: 0 4px 12px rgba(111, 66, 193, 0.15);
    }
    
    .product-status {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
        margin-left: 5px;
    }
    
    .status-available { background: #28a745; }
    .status-low { background: #ffc107; }
    .status-out { background: #dc3545; }
    
    .quick-actions {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }
    
    .action-btn {
        padding: 1rem;
        border-radius: 12px;
        border: 2px solid #e9ecef;
        background: white;
        transition: all 0.3s ease;
        text-decoration: none;
        color: #495057;
        display: block;
        text-align: center;
    }
    
    .action-btn:hover {
        border-color: #6f42c1;
        background: #6f42c1;
        color: white;
        transform: translateY(-2px);
        text-decoration: none;
    }
    
    .filters-section {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }
</style>
{% endblock %}

{% block content %}
<!-- Inventory Header -->
<div class="inventory-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="display-5 mb-3">ğŸ“¦ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¨Ø§Ø±</h1>
                <p class="lead mb-0">Ù†Ø¸Ø§Ø±Øª Ùˆ Ú©Ù†ØªØ±Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø± ØªÙ…Ø§Ù… Ø§Ù†Ø¨Ø§Ø±Ù‡Ø§</p>
            </div>
            <div class="col-md-4 text-end">
                <a href="{% url 'core:admin_dashboard' %}" class="btn btn-light me-2">
                    â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                </a>
                <button class="btn btn-outline-light" onclick="generateReport()">
                    ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
                </button>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <!-- Overall Statistics -->
    <div class="inventory-stats">
    <h4 class="mb-4">ğŸ“Š Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ</h4>
    <div class="row">
        <div class="col-md-2">
            <div class="stat-box stat-primary">
                <h3>{{ inventory_stats.total_items }}</h3>
                <small>ğŸ“¦ Ú©Ù„ Ø§Ù‚Ù„Ø§Ù…</small>
            </div>
        </div>
        <div class="col-md-2">
            <div class="stat-box stat-success">
                <h3>{{ inventory_stats.in_stock }}</h3>
                <small>âœ… Ù…ÙˆØ¬ÙˆØ¯</small>
            </div>
        </div>
        <div class="col-md-2">
            <div class="stat-box stat-warning">
                <h3>{{ inventory_stats.low_stock }}</h3>
                <small>âš ï¸ Ú©Ù… Ù…ÙˆØ¬ÙˆØ¯</small>
            </div>
        </div>
        <div class="col-md-2">
            <div class="stat-box stat-danger">
                <h3>{{ inventory_stats.sold_out }}</h3>
                <small>âŒ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</small>
            </div>
        </div>
        <div class="col-md-2">
            <div class="stat-box stat-info">
                <h3>{{ inventory_stats.capacity_percent }}%</h3>
                <small>ğŸ“ˆ Ø¸Ø±ÙÛŒØª Ø§Ù†Ø¨Ø§Ø±</small>
            </div>
        </div>
    </div>
</div>


    <!-- Quick Actions -->
    <div class="quick-actions">
        <h4 class="mb-4">âš¡ Ø¹Ù…Ù„ÛŒØ§Øª Ø³Ø±ÛŒØ¹</h4>
        <div class="row">
            <div class="col-md-3">
                <a href="#" class="action-btn" onclick="showCreateProductForm()">
    <div class="mb-2">â•</div>
    <strong>Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„</strong>
    <small class="d-block text-muted">Ø«Ø¨Øª Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</small>
</a>
<div id="createProductForm" style="display:none;">
    <h5>Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</h5>
    <input type="text" id="reel_number" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø±ÛŒÙ„"><br>
    <input type="text" id="location" placeholder="Ù…ÙˆÙ‚Ø¹ÛŒØª"><br>
    <input type="number" id="width" placeholder="Ø¹Ø±Ø¶"><br>
    <input type="number" id="gsm" placeholder="Ú¯Ø±Ù…Ø§Ú˜"><br>
    <input type="number" id="length" placeholder="Ø·ÙˆÙ„"><br>
    <input type="text" id="grade" placeholder="Ú¯Ø±ÛŒØ¯"><br>
    <button onclick="submitNewProduct()">Ø«Ø¨Øª</button>
</div>

        </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
        <form method="GET" class="row g-3">
            <div class="col-md-4">
                <label class="form-label">ğŸ” Ø¬Ø³ØªØ¬Ùˆ Ù…Ø­ØµÙˆÙ„</label>
                <input type="text" name="search" class="form-control" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø±ÛŒÙ„ØŒ Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„...">
            </div>
            <div class="col-md-3">
                <label class="form-label">ğŸ“ Ø§Ù†Ø¨Ø§Ø±</label>
                <select name="warehouse" class="form-select">
                    <option value="">Ù‡Ù…Ù‡ Ø§Ù†Ø¨Ø§Ø±Ù‡Ø§</option>
                    <option value="Anbar_Akhal">ğŸ“ Ø§Ù†Ø¨Ø§Ø± Ø¢Ø®Ø§Ù„</option>
                    <option value="Anbar_Muhvateh_Kordan">ğŸ“ Ø§Ù†Ø¨Ø§Ø± Ù…Ø­ÙˆØ·Ù‡ Ú©Ø±Ø¯Ø§Ù†</option>
                    <option value="Anbar_Khamir_Kordan">ğŸ“ Ø§Ù†Ø¨Ø§Ø± Ú©Ø±Ø¯Ø§Ù†</option>
                    <option value="Anbar_Khamir_Ghadim">ğŸ“ Ø§Ù†Ø¨Ø§Ø± Ø®Ù…ÛŒØ± Ù‚Ø¯ÛŒÙ…</option>
                    <option value="Anbar_Koochak">ğŸ“ Ø§Ù†Ø¨Ø§Ø± Ú©ÙˆÚ†Ú©</option>
                    <option value="Anbar_Salon_Tolid">ğŸ“ Ø§Ù†Ø¨Ø§Ø± Ø³Ø§Ù„Ù† ØªÙˆÙ„ÛŒØ¯</option>
                    <option value="Anbar_Sangin">ğŸ“ Ø§Ù†Ø¨Ø§Ø± Ø³Ù†Ú¯ÛŒÙ†</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ</label>
                <select name="status" class="form-select">
                    <option value="">Ù‡Ù…Ù‡ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§</option>
                    <option value="available">âœ… Ù…ÙˆØ¬ÙˆØ¯</option>
                    <option value="low">âš ï¸ Ú©Ù… Ù…ÙˆØ¬ÙˆØ¯</option>
                    <option value="out">âŒ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
                </div>
            </div>
        </form>
    </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>

// Update inventory
function updateInventory() {
    showNotification('ğŸ”„ ÙØ±Ù… Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª', 'info');
}

// Transfer products between warehouses
function transferProducts() {
    showNotification('ğŸ”„ ÙØ±Ù… Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª', 'info');
}

// Scan QR code
function scanQR() {
    showNotification('ğŸ“± Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø³Ú©Ù† QR Ú©Ø¯ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª', 'info');
}

// Generate inventory report
function generateReport() {
    showNotification('ğŸ“Š ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª', 'info');
}

// View all warehouses
function viewAllWarehouses() {
    showNotification('ğŸ¢ ØµÙØ­Ù‡ ØªÙ…Ø§Ù… Ø§Ù†Ø¨Ø§Ø±Ù‡Ø§ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª', 'info');
}

// Show notification
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 5000);
}

// Real-time inventory updates
setInterval(() => {
    // Simulate real-time updates
    updateInventoryStats();
}, 60000); // Update every minute

function updateInventoryStats() {
    // This would fetch real data from the server
    console.log('ğŸ”„ Updating inventory statistics...');
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ“¦ Inventory management page loaded');
    
    // Add hover effects to warehouse cards
    const warehouseCards = document.querySelectorAll('.warehouse-card');
    warehouseCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-3px)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});

function showCreateProductForm() {
    document.getElementById("createProductForm").style.display = "block";
}

function toSafeFloat(value) {
  const n = parseFloat(value);
  return isNaN(n) ? 0 : n;
}

function toSafeInt(value) {
  const n = parseInt(value);
  return isNaN(n) ? 0 : n;
}

function submitNewProduct() {
  const data = {
    reel_number: document.getElementById("reel_number").value.trim(),
    location: document.getElementById("location").value.trim(),
    width: parseInt(document.getElementById("width").value) || 0,
    gsm: parseInt(document.getElementById("gsm").value) || 0,
    length: parseInt(document.getElementById("length").value) || 0,
    grade: document.getElementById("grade").value.trim(),
    price: toSafeFloat(document.getElementById("price")?.value),
    breaks: toSafeInt(document.getElementById("breaks")?.value),
  };

  fetch("/core/api/create-product/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-CSRFToken": getCookie("csrftoken"),
    },
    body: JSON.stringify(data),
  })
    .then((res) => res.json())
    .then((res) => {
      if (res.success) alert("âœ… Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!");
      else alert("âŒ Ø®Ø·Ø§: " + res.error);
    })
    .catch((err) => {
      alert("âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡");
      console.error(err);
    });
}



function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === name + "=") {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

</script>
{% endblock %} 