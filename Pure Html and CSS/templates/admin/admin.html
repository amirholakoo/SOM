{% extends 'base.html' %}
{% load static %}

{% block title %}Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª - Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ú©Ø§ØºØ° Ùˆ Ù…Ù‚ÙˆØ§ÛŒ Ù‡Ù…Ø§ÛŒÙˆÙ†{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/styles.css' %}">
<link rel="stylesheet" href="{% static 'css/admin.css' %}">
{% endblock %}

{% block body_class %}admin-body{% endblock %}

{% block content %}
<div class="admin-container">
    <!-- Mobile Header -->
    <header class="mobile-header">
        <div class="mobile-header-content">
            <button class="hamburger-btn" id="hamburgerBtn" onclick="toggleSidebar()">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            <div class="mobile-title">
                <span class="mobile-logo">ğŸ‘¨â€ğŸ’¼</span>
                <h1 class="mobile-title-text">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h1>
            </div>
            <div class="mobile-actions">
                <button class="mobile-action-btn" onclick="showMobileSearch()">
                    <span class="action-icon">ğŸ”</span>
                </button>
                <button class="mobile-action-btn" onclick="showMobileMenu()">
                    <span class="action-icon">â‹®</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Sidebar Navigation -->
    <aside class="admin-sidebar" id="adminSidebar">
        <div class="sidebar-header">
            <div class="admin-logo">ğŸ‘¨â€ğŸ’¼</div>
            <h2 class="admin-title">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
            <button class="sidebar-close-btn" onclick="toggleSidebar()">Ã—</button>
        </div>

        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <button class="nav-btn {% if active_section == 'cms' %}active{% endif %}" data-section="cms"
                        onclick="showSection('cms')">
                        <span class="nav-icon">ğŸ‘¥</span>
                        <span class="nav-text">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</span>
                        <span class="nav-badge">{{ users_count|default:0 }}</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn {% if active_section == 'inventory' %}active{% endif %}"
                        data-section="inventory" onclick="showSection('inventory')">
                        <span class="nav-icon">ğŸ“¦</span>
                        <span class="nav-text">Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ</span>
                        <span class="nav-badge">{{ products_count|default:0 }}</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn {% if active_section == 'orders' %}active{% endif %}" data-section="orders"
                        onclick="showSection('orders')">
                        <span class="nav-icon">ğŸ“‹</span>
                        <span class="nav-text">Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´Ø§Øª</span>
                        <span class="nav-badge">{{ orders_count|default:0 }}</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn {% if active_section == 'working-hours' %}active{% endif %}"
                        data-section="working-hours" onclick="showSection('working-hours')">
                        <span class="nav-icon">ğŸ•</span>
                        <span class="nav-text">Ø³Ø§Ø¹Øª Ú©Ø§Ø±ÛŒ</span>
                        <span class="nav-status {% if working_hours.is_active %}active{% endif %}">
                            {% if working_hours.is_active %}ÙØ¹Ø§Ù„{% else %}ØºÛŒØ±ÙØ¹Ø§Ù„{% endif %}
                        </span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn {% if active_section == 'main-page' %}active{% endif %}"
                        data-section="main-page" onclick="showSection('main-page')">
                        <span class="nav-icon">ğŸ </span>
                        <span class="nav-text">Ù…Ø¯ÛŒØ±ÛŒØª ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</span>
                        <span class="nav-badge">2</span>
                    </button>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <div class="admin-profile-sidebar">
                <div class="admin-avatar-sidebar">ğŸ‘¨â€ğŸ’¼</div>
                <div class="admin-info-sidebar">
                    <span class="admin-name-sidebar">{{ user.get_full_name|default:'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…' }}</span>
                    <span class="admin-role-sidebar">{{ user.role|default:'Administrator' }}</span>
                </div>
            </div>
            <form method="POST" action="{% url 'auth:logout' %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="logout-btn">
                    <span class="logout-icon">ğŸšª</span>
                    <span class="logout-text">Ø®Ø±ÙˆØ¬</span>
                </button>
            </form>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="admin-main">
        <!-- Desktop Header -->
        <header class="admin-header">
            <div class="header-content">
                <h1 class="section-title" id="sectionTitle">
                    {% if active_section == 'cms' %}Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                    {% elif active_section == 'inventory' %}Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ
                    {% elif active_section == 'orders' %}Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´Ø§Øª
                    {% elif active_section == 'working-hours' %}Ø³Ø§Ø¹Øª Ú©Ø§Ø±ÛŒ
                    {% elif active_section == 'main-page' %}Ù…Ø¯ÛŒØ±ÛŒØª ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
                    {% else %}Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†{% endif %}
                </h1>
                <div class="header-actions">
                    <div class="admin-info">
                        <span class="admin-name">{{ user.get_full_name|default:'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…' }}</span>
                        <span class="admin-role">{{ user.role|default:'Administrator' }}</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content Sections -->
        <div class="content-wrapper">
            <!-- CMS Section - User Management -->
            <section id="cms" class="content-section {% if active_section == 'cms' %}active{% endif %}">
                <div class="section-header">
                    <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>
                    <button class="action-btn primary-btn" onclick="showAddUserModal()">
                        <span class="btn-icon">â•</span>
                        <span class="btn-text">Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</span>
                    </button>
                </div>

                <!-- User Filters -->
                <div class="filters-container">
                    <div class="filter-group">
                        <label for="userStatusFilter">ÙˆØ¶Ø¹ÛŒØª:</label>
                        <select id="userStatusFilter" onchange="filterUsers()">
                            <option value="">Ù‡Ù…Ù‡</option>
                            <option value="approved">ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡</option>
                            <option value="pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option value="deactive">ØºÛŒØ±ÙØ¹Ø§Ù„</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="userSearch">Ø¬Ø³ØªØ¬Ùˆ:</label>
                        <input type="text" id="userSearch" placeholder="Ù†Ø§Ù…ØŒ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†..." onkeyup="filterUsers()">
                    </div>
                    <div class="filter-group">
                        <button class="action-btn secondary-btn" onclick="exportUsers()">
                            <span class="btn-icon">ğŸ“Š</span>
                            <span class="btn-text">Ø®Ø±ÙˆØ¬ÛŒ Excel</span>
                        </button>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="table-container">
                    <table class="admin-table" id="usersTable">
                        <thead>
                            <tr>
                                <th>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th>
                                <th>Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</th>
                                <th>Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            {% for user_item in users %}
                            <tr>
                                <td>{{ user_item.get_full_name|default:user_item.username }}</td>
                                <td>{{ user_item.phone_number }}</td>
                                <td>
                                    <span class="status-badge status-{{ user_item.status|default:'pending' }}">
                                        {% if user_item.status == 'approved' %}ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡
                                        {% elif user_item.status == 'pending' %}Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
                                        {% else %}ØºÛŒØ±ÙØ¹Ø§Ù„{% endif %}
                                    </span>
                                </td>
                                <td>{{ user_item.date_joined|date:'Y/m/d' }}</td>
                                <td>{{ user_item.last_login|date:'Y/m/d H:i'|default:'Ù‡ÛŒÚ†ÙˆÙ‚Øª' }}</td>
                                <td>
                                    <button class="action-btn edit-btn"
                                        onclick="editUser({{ user_item.id }})">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                                    <button class="action-btn delete-btn"
                                        onclick="deleteUser({{ user_item.id }})">Ø­Ø°Ù</button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="no-data">Ù‡ÛŒÚ† Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Inventory Section -->
            <section id="inventory" class="content-section {% if active_section == 'inventory' %}active{% endif %}">
                <div class="section-header">
                    <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ</h2>
                    <button class="action-btn primary-btn" onclick="showAddProductModal()">
                        <span class="btn-icon">â•</span>
                        <span class="btn-text">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</span>
                    </button>
                </div>

                <!-- Products Table -->
                <div class="table-container">
                    <table class="admin-table" id="productsTable">
                        <thead>
                            <tr>
                                <th>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)</th>
                                <th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            {% for product in products %}
                            <tr>
                                <td>{{ product.name }}</td>
                                <td>{{ product.get_type_display }}</td>
                                <td>{{ product.price|floatformat:0 }}</td>
                                <td>{{ product.stock }}</td>
                                <td>
                                    <span class="status-badge status-{{ product.status }}">
                                        {{ product.get_status_display }}
                                    </span>
                                </td>
                                <td>
                                    <button class="action-btn edit-btn"
                                        onclick="editProduct({{ product.id }})">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                                    <button class="action-btn delete-btn"
                                        onclick="deleteProduct({{ product.id }})">Ø­Ø°Ù</button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="no-data">Ù‡ÛŒÚ† Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Working Hours Section -->
            <section id="working-hours"
                class="content-section {% if active_section == 'working-hours' %}active{% endif %}">
                <div class="section-header">
                    <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø¹Øª Ú©Ø§Ø±ÛŒ</h2>
                    <button class="action-btn primary-btn" onclick="showWorkingHoursModal()">
                        <span class="btn-icon">âš™ï¸</span>
                        <span class="btn-text">ØªÙ†Ø¸ÛŒÙ… Ø³Ø§Ø¹Øª Ú©Ø§Ø±ÛŒ</span>
                    </button>
                </div>

                <div class="working-hours-info">
                    <div class="info-card">
                        <div class="info-header">
                            <h3>Ø³Ø§Ø¹Øª Ú©Ø§Ø±ÛŒ ÙØ¹Ù„ÛŒ</h3>
                            <span class="status-indicator {% if working_hours.is_active %}active{% endif %}"
                                id="workingHoursStatus">
                                {% if working_hours.is_active %}ÙØ¹Ø§Ù„{% else %}ØºÛŒØ±ÙØ¹Ø§Ù„{% endif %}
                            </span>
                        </div>
                        <div class="info-content">
                            <div class="time-range">
                                <span class="time-label">Ø§Ø²:</span>
                                <span class="time-value" id="currentStartTime">{{
                                    working_hours.start_time|default:'08:00' }}</span>
                            </div>
                            <div class="time-range">
                                <span class="time-label">ØªØ§:</span>
                                <span class="time-value" id="currentEndTime">{{ working_hours.end_time|default:'18:00'
                                    }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/admin.js' %}"></script>
{% endblock %}