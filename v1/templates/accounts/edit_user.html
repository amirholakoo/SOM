{% extends 'base.html' %}
{% load static %}

{% block title %}ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± - HomayOMS{% endblock %}

{% block extra_css %}
<style>
    .edit-user-header {
        background: linear-gradient(90deg, #3498db 0%, #6dd5fa 100%);
        color: #fff;
        border-radius: 1rem;
        padding: 2rem 1rem 1rem 1rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 24px rgba(52,152,219,0.08);
    }
    
    .edit-user-card {
        border-radius: 1rem;
        box-shadow: 0 2px 12px rgba(52,152,219,0.07);
        margin-bottom: 1.5rem;
    }
    
    .form-section {
        background-color: #f8f9fa;
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .section-title {
        font-weight: 600;
        color: #495057;
        margin-bottom: 1rem;
        border-bottom: 2px solid #dee2e6;
        padding-bottom: 0.5rem;
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .form-group {
        margin-bottom: 1rem;
    }
    
    .form-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 0.5rem;
        display: block;
    }
    
    .required-field::after {
        content: " *";
        color: #dc3545;
    }
    
    .form-control {
        border-radius: 0.5rem;
        border: 1px solid #ced4da;
        padding: 0.75rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    
    .form-control:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
    }
    
    .form-select {
        border-radius: 0.5rem;
        border: 1px solid #ced4da;
        padding: 0.75rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    
    .form-select:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
    }
    
    .btn-save {
        background-color: #198754;
        border-color: #198754;
        color: white;
        padding: 0.75rem 2rem;
        border-radius: 0.5rem;
        font-weight: 600;
    }
    
    .btn-save:hover {
        background-color: #157347;
        border-color: #157347;
        color: white;
    }
    
    .btn-cancel {
        background-color: #6c757d;
        border-color: #6c757d;
        color: white;
        padding: 0.75rem 2rem;
        border-radius: 0.5rem;
        font-weight: 600;
    }
    
    .btn-cancel:hover {
        background-color: #5a6268;
        border-color: #5a6268;
        color: white;
    }
    
    .user-info-box {
        background-color: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .field-help {
        font-size: 0.875rem;
        color: #6c757d;
        margin-top: 0.25rem;
    }
    
    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="edit-user-header d-flex align-items-center justify-content-between flex-wrap mb-4">
        <div>
            <h2 class="mb-1">ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±</h2>
            <div class="small">ØªØºÛŒÛŒØ± Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± {{ user_to_edit.username }}</div>
        </div>
        <div class="d-flex align-items-center gap-3 mt-3 mt-md-0">
            <a href="{% url 'accounts:user_list' %}" class="btn btn-outline-light btn-sm">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</a>
        </div>
    </div>

    <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… -->
    {% if messages %}
        <div class="mb-4">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± -->
    <div class="user-info-box">
        <strong>ï¿½ï¿½ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±:</strong><br>
        Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: <strong>{{ user_to_edit.username }}</strong> | 
        ØªØ§Ø±ÛŒØ® Ø¹Ø¶ÙˆÛŒØª: <strong>{{ user_to_edit.date_joined|date:"Y/m/d" }}</strong> | 
        Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯: <strong>{{ user_to_edit.last_login|date:"Y/m/d H:i"|default:"Ù‡ÛŒÚ†â€ŒÙˆÙ‚Øª" }}</strong>
    </div>

    <div class="card edit-user-card">
        <div class="card-body">
            <form method="post" id="editUserForm">
                {% csrf_token %}
                
                <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ -->
                <div class="form-section">
                    <div class="section-title">ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="first_name" class="form-label required-field">Ù†Ø§Ù…</label>
                            <input 
                                type="text" 
                                id="first_name" 
                                name="first_name" 
                                value="{{ user_to_edit.first_name|default:'' }}"
                                class="form-control"
                                required
                                autocomplete="given-name"
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="last_name" class="form-label">Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                            <input 
                                type="text" 
                                id="last_name" 
                                name="last_name" 
                                value="{{ user_to_edit.last_name|default:'' }}"
                                class="form-control"
                                autocomplete="family-name"
                            >
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="email" class="form-label">ğŸ“§ Ø§ÛŒÙ…ÛŒÙ„</label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                value="{{ user_to_edit.email|default:'' }}"
                                class="form-control"
                                autocomplete="email"
                            >
                            <div class="field-help">Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡â€ŒÙ‡Ø§ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone" class="form-label required-field">ğŸ“± Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</label>
                            <input 
                                type="tel" 
                                id="phone" 
                                name="phone" 
                                value="{{ user_to_edit.phone|default:'' }}"
                                class="form-control"
                                placeholder="09123456789"
                                maxlength="11"
                                pattern="09[0-9]{9}"
                                required
                                autocomplete="tel"
                            >
                            <div class="field-help">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ 09 Ø´Ø±ÙˆØ¹ Ø´Ø¯Ù‡ Ùˆ 11 Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯</div>
                        </div>
                    </div>
                </div>
                
                <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ… -->
                <div class="form-section">
                    <div class="section-title">âš™ï¸ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="role" class="form-label required-field">ğŸ­ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                            <select id="role" name="role" class="form-select" required>
                                {% for role_value, role_label in user_roles %}
                                    <option value="{{ role_value }}" {% if user_to_edit.role == role_value %}selected{% endif %}>
                                        {{ role_label }}
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="field-help">Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø± Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ùˆ Ø±Ø§ ØªØ¹ÛŒÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="status" class="form-label required-field">ğŸ“Š ÙˆØ¶Ø¹ÛŒØª</label>
                            <select id="status" name="status" class="form-select" required>
                                {% for status_value, status_label in user_statuses %}
                                    <option value="{{ status_value }}" {% if user_to_edit.status == status_value %}selected{% endif %}>
                                        {{ status_label }}
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="field-help">ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø³ÛŒØ³ØªÙ…</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="department" class="form-label">ğŸ¢ Ø¨Ø®Ø´ Ú©Ø§Ø±ÛŒ</label>
                        <input 
                            type="text" 
                            id="department" 
                            name="department" 
                            value="{{ user_to_edit.department|default:'' }}"
                            class="form-control"
                            placeholder="Ù…Ø«Ø§Ù„: ÙØ±ÙˆØ´ØŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒØŒ Ù…Ø§Ù„ÛŒ"
                        >
                        <div class="field-help">Ø¨Ø®Ø´ ÛŒØ§ ÙˆØ§Ø­Ø¯ Ú©Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</div>
                    </div>
                </div>
                
                <!-- ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ -->
                <div class="form-section">
                    <div class="section-title">ğŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§</div>
                    
                    <div class="form-group">
                        <label for="notes" class="form-label">ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ</label>
                        <textarea 
                            id="notes" 
                            name="notes" 
                            rows="4"
                            class="form-control"
                            placeholder="ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ú©Ø§Ø±Ø¨Ø±..."
                        >{{ user_to_edit.notes|default:'' }}</textarea>
                        <div class="field-help">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¶Ø§ÙÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯</div>
                    </div>
                </div>
                
                <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª -->
                <div class="d-flex justify-content-between align-items-center mt-4">
                    <a href="{% url 'accounts:user_list' %}" class="btn btn-cancel">
                        âŒ Ø§Ù†ØµØ±Ø§Ù
                    </a>
                    
                    <button type="submit" class="btn btn-save">
                        ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// ÙØ±Ù…Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†
document.getElementById('phone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, ''); // Ø­Ø°Ù Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ ØºÛŒØ± Ø¹Ø¯Ø¯ÛŒ
    if (value.length > 11) {
        value = value.substring(0, 11);
    }
    e.target.value = value;
});

// Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù… Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±Ø³Ø§Ù„
document.getElementById('editUserForm').addEventListener('submit', function(e) {
    const first_name = document.getElementById('first_name').value.trim();
    const phone = document.getElementById('phone').value;
    
    let errors = [];
    
    if (!first_name) {
        errors.push('Ù†Ø§Ù… Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
    }
    
    if (!phone) {
        errors.push('Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
    } else if (!phone.match(/^09[0-9]{9}$/)) {
        errors.push('Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ 09 Ø´Ø±ÙˆØ¹ Ø´Ø¯Ù‡ Ùˆ 11 Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯');
    }
    
    if (errors.length > 0) {
        e.preventDefault();
        alert('Ù„Ø·ÙØ§Ù‹ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø±Ø·Ø±Ù Ú©Ù†ÛŒØ¯:\n\n' + errors.join('\n'));
    }
});

// Focus Ø®ÙˆØ¯Ú©Ø§Ø± Ø±ÙˆÛŒ ÙÛŒÙ„Ø¯ Ù†Ø§Ù…
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('first_name').focus();
});
</script>
{% endblock %}
