# ๐งช ุชุณุชโูุง HomayOMS - ูุณุชูุฏุงุช ฺฉุงูู

## ๐ ููุง ฺฉู

ูพุฑูฺู HomayOMS ุดุงูู ูุฌููุนู ฺฉุงูู ุงุฒ ุชุณุชโูุง ุฎูุฏฺฉุงุฑ ุงุณุช ฺฉู ุจุฑุง ุฏุณุชุงุจ ุจู **90% ูพูุดุด ฺฉุฏ** ุทุฑุงุญ ุดุฏูโุงูุฏ. ุงู ุชุณุชโูุง ุชูุงู ุฌูุจูโูุง ุงุตู ุณุณุชู ุฑุง ูพูุดุด ูโุฏููุฏ:

## ๐ฏ ุงูุฏุงู ุชุณุช

- โ **ุงุฌุงุฏ ฺฉุงุฑุจุฑุงู** ุจุง ููุดโูุง ูุฎุชูู
- โ **ุฎุฑุฏ ฺฉุงุฑุจุฑุงู** ู ูุฑุขูุฏ ุณูุงุฑุดโุฏู
- โ **ุงุฌุงุฏ Super Admin** ู ุชูุธูุงุช ูุฏุฑุช
- โ **ูุฌูุฒูุง Super Admin** ู ฺฉูุชุฑู ุฏุณุชุฑุณ
- โ **ูุฌูุฒูุง Admin** ู ูุญุฏูุฏุชโูุง
- โ **ูุฌูุฒูุง Finance** ู ูุฏุฑุช ูุงู
- โ **ูุฌูุฒูุง Customer** ู ูุญุฏูุฏุชโูุง
- โ **ุงุฌุงุฏ ูพุฑุฏุงุฎุช** ู ุฏุฑฺฏุงูโูุง ูุฎุชูู
- โ **ูพุฑุฏุงุฎุช ูููู** ู ูพุฑุฏุงุฒุด ุชุฑุงฺฉูุดโูุง
- โ **ูพุฑุฏุงุฎุช ูุงูููู** ู ูุฏุฑุช ุฎุทุงูุง

## ๐ ุณุงุฎุชุงุฑ ูุงูโูุง ุชุณุช

```
v1/
โโโ tests/
โ   โโโ __init__.py
โ   โโโ test_basic.py              # ุชุณุชโูุง ูพุงู
โ   โโโ test_user_creation.py      # ุชุณุชโูุง ุงุฌุงุฏ ฺฉุงุฑุจุฑ
โ   โโโ test_user_purchase.py      # ุชุณุชโูุง ุฎุฑุฏ ฺฉุงุฑุจุฑุงู
โ   โโโ test_permissions.py        # ุชุณุชโูุง ูุฌูุฒูุง
โ   โโโ test_payments.py           # ุชุณุชโูุง ูพุฑุฏุงุฎุช
โโโ conftest.py                    # ูฺฉุณฺุฑูุง pytest
โโโ pytest.ini                    # ุชูุธูุงุช pytest
โโโ run_tests.py                   # ุงุฌุฑุงฺฉููุฏู ุชุณุชโูุง
โโโ README_TESTS.md               # ุงู ูุงู
```

## ๐งช ุงููุงุน ุชุณุชโูุง

### 1. ุชุณุชโูุง ุงุฌุงุฏ ฺฉุงุฑุจุฑ (`test_user_creation.py`)

- **TestUserCreation**: ุชุณุชโูุง unittest ุจุฑุง ุงุฌุงุฏ ฺฉุงุฑุจุฑุงู
  - ุงุฌุงุฏ Super Admin
  - ุงุฌุงุฏ Admin
  - ุงุฌุงุฏ Finance
  - ุงุฌุงุฏ Customer
  - ุงุนุชุจุงุฑุณูุฌ ุดูุงุฑู ุชููู
  - ฺฉุชุง ูุงู ฺฉุงุฑุจุฑ ู ุดูุงุฑู ุชููู
  - ุชุนู ฺฏุฑููโูุง ฺฉุงุฑุจุฑ
  - ุงุฌุงุฏ ุฎูุฏฺฉุงุฑ ูพุฑููุงู ูุดุชุฑ

- **TestUserCreationIntegration**: ุชุณุชโูุง ฺฉูพุงุฑฺฺฏ
  - ุงุฌุงุฏ ฺูุฏู ฺฉุงุฑุจุฑ ููุฒูุงู
  - ุชุนู ูุฌูุฒูุง
  - ุงุฌุงุฏ ููุฒูุงู ฺฉุงุฑุจุฑุงู

- **TestUserCreationPytest**: ุชุณุชโูุง pytest
  - ุงุณุชูุงุฏู ุงุฒ ูฺฉุณฺุฑูุง
  - ุชุณุชโูุง ูพุงุฑุงูุชุฑ
  - Factory Pattern

### 2. ุชุณุชโูุง ุฎุฑุฏ ฺฉุงุฑุจุฑุงู (`test_user_purchase.py`)

- **TestUserPurchaseProcess**: ูุฑุขูุฏ ฺฉุงูู ุฎุฑุฏ
  - ุงุฌุงุฏ ุณูุงุฑุด
  - ุงูุฒูุฏู ุขุชูโูุง
  - ูุญุงุณุจู ููุช ู ุชุฎูู
  - ุงููุงุน ุฑูุดโูุง ูพุฑุฏุงุฎุช
  - ุจุฑุฑุณ ููุฌูุฏ ูุญุตููุงุช
  - ุชุบุฑ ูุถุนุช ุณูุงุฑุด

- **TestCustomerPurchasePermissions**: ฺฉูุชุฑู ุฏุณุชุฑุณ
  - ูุฌูุฒูุง ูุดุชุฑ ูุนุงู/ุบุฑูุนุงู
  - ูุญุฏูุฏุช ุฏุณุชุฑุณ ุจู ุณูุงุฑุดุงุช

### 3. ุชุณุชโูุง ูุฌูุฒูุง (`test_permissions.py`)

- **TestRoleBasedPermissions**: ูุฌูุฒูุง ูุจุชู ุจุฑ ููุด
  - ุชุณุช ูุฌูุฒูุง ูุฑ ููุด
  - ฺฉูุชุฑู ุฏุณุชุฑุณโูุง ูุฎุชูู

- **TestPermissionDecorators**: ุฏฺฉูุฑุชูุฑูุง ูุฌูุฒ
  - `@super_admin_required`
  - `@admin_required`
  - `@role_required`
  - `@check_user_permission`

- **TestPermissionMixins**: ูฺฉุณูโูุง ูุฌูุฒ
  - `SuperAdminRequiredMixin`
  - `AdminRequiredMixin`
  - `RoleRequiredMixin`

### 4. ุชุณุชโูุง ูพุฑุฏุงุฎุช (`test_payments.py`)

- **TestPaymentCreation**: ุงุฌุงุฏ ูพุฑุฏุงุฎุช
  - ุงุฌุงุฏ ูพุฑุฏุงุฎุช ูพุงู
  - ุชููุฏ ฺฉุฏ ูพฺฏุฑ
  - ุชุบุฑ ูุถุนุช ูพุฑุฏุงุฎุช
  - ุนูุงูุชโฺฏุฐุงุฑ ูููู/ูุงูููู

- **TestPaymentGateways**: ุฏุฑฺฏุงูโูุง ูพุฑุฏุงุฎุช
  - ุฒุฑูโูพุงู
  - ุดุงูพุฑฺฉ
  - Mock ุฏุฑฺฏุงูโูุง

- **TestPaymentService**: ุณุฑูุณ ูพุฑุฏุงุฎุช
  - ูุญุงุณุจู ูุจูุบ ููุฏ
  - ุงุฌุงุฏ ูพุฑุฏุงุฎุช ุงุฒ ุณูุงุฑุด
  - ุชุงุฏ ูพุฑุฏุงุฎุช

## ๐ง ูุญูู ุงุฌุฑุง

### ุงุฌุฑุง ฺฉุงูู ุชุณุชโูุง
```bash
python run_tests.py
```

### ุงุฌุฑุง ููุท unittest
```bash
python run_tests.py --unittest-only
```

### ุงุฌุฑุง ููุท pytest
```bash
python run_tests.py --pytest-only
```

### ุงุฌุฑุง ุฏุณุชูโุจูุฏ ุฎุงุต
```bash
python run_tests.py --markers unit
python run_tests.py --markers permissions
python run_tests.py --markers payments
```

### ุชููุฏ ฺฏุฒุงุฑุด HTML
```bash
python run_tests.py --html-report
```

## ๐ ฺฏุฒุงุฑุด ูพูุดุด ฺฉุฏ

```bash
# ุงุฌุฑุง ุจุง coverage
coverage run --source='.' manage.py test

# ููุงุด ฺฏุฒุงุฑุด
coverage report --show-missing

# ุชููุฏ ฺฏุฒุงุฑุด HTML
coverage html
firefox htmlcov/index.html
```

## ๐ญ ูุงุฑฺฉุฑูุง pytest

- `@pytest.mark.unit`: ุชุณุชโูุง ูุงุญุฏ
- `@pytest.mark.integration`: ุชุณุชโูุง ฺฉูพุงุฑฺฺฏ
- `@pytest.mark.permissions`: ุชุณุชโูุง ูุฌูุฒูุง
- `@pytest.mark.payments`: ุชุณุชโูุง ูพุฑุฏุงุฎุช
- `@pytest.mark.user_creation`: ุชุณุชโูุง ุงุฌุงุฏ ฺฉุงุฑุจุฑ
- `@pytest.mark.slow`: ุชุณุชโูุง ฺฉูุฏ

## ๐ญ ูฺฉุณฺุฑูุง ููุฌูุฏ

### ฺฉุงุฑุจุฑุงู
- `super_admin_user`
- `admin_user`
- `finance_user`
- `customer_user`
- `inactive_user`

### ูุดุชุฑุงู
- `customer`
- `inactive_customer`

### ูุญุตููุงุช
- `product`
- `sold_product`
- `multiple_products`

### ุณูุงุฑุดุงุช
- `order`
- `order_with_items`

### ูพุฑุฏุงุฎุชโูุง
- `payment`
- `successful_payment`
- `failed_payment`

### ฺฉูุงูุชโูุง ุงุญุฑุงุฒ ููุช ุดุฏู
- `authenticated_super_admin_client`
- `authenticated_admin_client`
- `authenticated_finance_client`
- `authenticated_customer_client`

## ๐ ุขูุงุฑ ูพูุดุด ูุนู

ูุฏู: **90% ูพูุดุด ฺฉุฏ**

### ุจุฎุดโูุง ุชุณุช ุดุฏู:
- โ ูุฏูโูุง User
- โ ูุฏูโูุง Customer
- โ ูุฏูโูุง Product
- โ ูุฏูโูุง Order
- โ ูุฏูโูุง Payment
- โ ุณุณุชู ูุฌูุฒูุง
- โ ุฏฺฉูุฑุชูุฑูุง ู ูฺฉุณูโูุง
- โ ูุฑุขูุฏ ุฎุฑุฏ
- โ ุฏุฑฺฏุงูโูุง ูพุฑุฏุงุฎุช

## ๐ ุฑูุน ุงุดฺฉุงูุงุช ุฑุงุฌ

### ุฎุทุง UNIQUE constraint
ุงฺฏุฑ ุงู ุฎุทุง ุฑุฎ ุฏูุฏ:
```
IntegrityError: UNIQUE constraint failed
```

ุจุงุฏ ูฺฉุณฺุฑูุง ุฑุง ุจุง ูุงูโูุง ฺฉุชุง ุงุฌุงุฏ ฺฉุฑุฏ.

### ุฎุทุง Permission denied
ุจุฑุง ุฑูุน ูุดฺฉูุงุช ูุฌูุฒูุง:
```python
# ุงุทููุงู ุงุฒ ุงุฌุงุฏ ฺฏุฑููโูุง
python manage.py shell
>>> from accounts.models import User
>>> User.objects.create_default_groups()
```

## ๐ ุงูุฒูุฏู ุชุณุช ุฌุฏุฏ

### 1. ุชุณุช unittest
```python
class TestNewFeature(TestCase):
    def setUp(self):
        # ุชูุธูุงุช ุงููู
        pass
    
    def test_feature(self):
        # ุชุณุช ูฺฺฏ
        self.assertEqual(result, expected)
```

### 2. ุชุณุช pytest
```python
@pytest.mark.unit
def test_new_feature(fixture_name):
    # ุชุณุช ุจุง ูฺฉุณฺุฑ
    assert result == expected
```

## ๐ ุจูุชุฑู ุดููโูุง

1. **ูุงูโฺฏุฐุงุฑ**: ูุงูโูุง ุชูุตู ู ูุงุฑุณ ุจุฑุง ุชุณุชโูุง
2. **ูุณุชูู ุจูุฏู**: ูุฑ ุชุณุช ูุณุชูู ุงุฒ ุฏฺฏุฑุงู
3. **ูพุงฺฉโุณุงุฒ**: ุงุณุชูุงุฏู ุงุฒ ูฺฉุณฺุฑูุง ุจุฑุง ุฏุงุฏูโูุง ุชุณุช
4. **ูุงุฑฺฉุฑฺฏุฐุงุฑ**: ุฏุณุชูโุจูุฏ ุชุณุชโูุง ุจุง ูุงุฑฺฉุฑูุง ููุงุณุจ
5. **ูุณุชูุฏุณุงุฒ**: ฺฉุงููุชโูุง ูุงุฑุณ ุจุฑุง ุชูุถุญ ุชุณุชโูุง

## ๐ ูพุดุชุจุงู

ุจุฑุง ูุดฺฉูุงุช ุชุณุช:
1. ุจุฑุฑุณ ูุงฺฏโูุง ุฎุทุง
2. ุงุฌุฑุง ุชุณุชโูุง ูุฌุฒุง
3. ุจุฑุฑุณ ูฺฉุณฺุฑูุง
4. ุงุทููุงู ุงุฒ ุตุญุช ุชูุธูุงุช

---

**๐ฏ ูุฏู: ุฏุณุชุงุจ ุจู 90% ูพูุดุด ฺฉุฏ ู ุงุทููุงู ุงุฒ ฺฉูุช ูุฑูโุงูุฒุงุฑ** 